<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOR Calculator</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f4f4f9; }
    h1 { color: #333; margin: 20px 0; }
    .step { padding: 20px; border: 1px solid #ddd; border-radius: 10px; background: white; margin-bottom: 20px; }
    .step-indicator { display: flex; gap: 10px; margin-bottom: 20px; }
    .indicator { flex: 1; text-align: center; padding: 8px; border-radius: 8px; background: #ddd; font-weight: bold; cursor: pointer; transition: 0.3s; }
    .indicator:hover { background: #bbb; }
    .indicator.active { background: #007BFF; color: white; }
    #result { margin-top: 20px; font-size: 16px; font-weight: bold; color: #007BFF; }
  </style>
</head>
<body class="container">
	
	 <div style="position: relative; top: 0px; text-align: center;">
  <img src="PHED logo.png" alt="PHED" 
       style="width: 300px; height: auto; margin-bottom: 10px; display: block; margin-left: auto; margin-right: auto;">
  <h1>LOR CALCULATOR</h1>
</div>

<!--<h1>LOR Calculator</h1>-->

<!-- Step indicator -->
<div class="step-indicator">
  <div class="indicator active" id="ind1" onclick="showStep('step1', 1)">Step 1</div>
  <div class="indicator" id="ind2" onclick="showStep('step2', 2)">Step 2</div>
  <div class="indicator" id="ind3" onclick="showStep('step3', 3)">Step 3</div>
</div>

<!-- Step 1 -->
<div class="step" id="step1">
  <div class="row g-3">
    <!-- Region -->
    <div class="col-12 col-md-6 col-lg-4">
      <select id="region" class="form-control" required>
        <option value="" disabled selected>Select Region *</option>
        <option value="Calabar">Calabar</option>
      </select>
    </div>

    <!-- Voltage -->
    <div class="col-12 col-md-6 col-lg-4">
      <select id="voltage" class="form-control" required>
        <option value="" disabled selected>Select a Voltage Level *</option>
        <option value="11KV">11KV</option>
        <option value="33KV">33KV</option>
      </select>
    </div>

    <!-- Feeder -->
    <div class="col-12 col-md-6 col-lg-4">
      <select id="feeder" class="form-control" required>
        <option value="" disabled selected>Select a Feeder *</option>
      </select>
    </div>

    <!-- Band -->
    <div class="col-12 col-md-6 col-lg-4">
      <select id="band" class="form-control" required>
        <option value="" disabled selected>Select a Band *</option>
        <option value="209.5">Band A-Non MD</option>
        <option value="209.5">Band A-MD1</option>
        <option value="209.5">Band A-MD2</option>
        <option value="68.96">Band B-Non MD</option>
        <option value="67.18">Band B-MD1</option>
        <option value="67.12">Band B-MD2</option>
        <option value="56.38">Band C-Non MD</option>
        <option value="54.64">Band C-MD1</option>
        <option value="54.64">Band C-MD2</option>
        <option value="39.67">Band D-Non MD</option>
        <option value="55.43">Band D-MD1</option>
        <option value="55.43">Band D-MD2</option>
        <option value="39.44">Band E-Non MD</option>
        <option value="55.43">Band E-MD1</option>
        <option value="55.43">Band E-MD2</option>
      </select>
    </div>

    <!-- Feeder Info -->
    <div class="col-12">
      <div id="feederInfo"></div>
    </div>
  </div>
  <button class="btn btn-primary mt-3" id="next1">Next ‚û°Ô∏è</button>
</div>

<!-- Step 2 -->
<div class="step" id="step2" style="display:none;">
  <div class="row g-3">
    <div class="col-12 col-md-6">
      <label class="form-label">HT Lines (span)</label>
      <input id="B5" type="text" class="form-control">
    </div>
    <div class="col-12 col-md-6">
      <label class="form-label">HT/LT Lines (span)</label>
      <input id="C5" type="text" class="form-control">
    </div>
    <div class="col-12 col-md-6">
      <label class="form-label">LT Lines (span)</label>
      <input id="D5" type="text" class="form-control">
    </div>
    <div class="col-12 col-md-6">
      <label class="form-label">Peak Load (MW)</label>
      <input id="E5" type="number" class="form-control" value="0">
    </div>
  </div>
<div class="d-flex justify-content-between mt-3">
  <button class="btn btn-secondary" id="back2">‚¨ÖÔ∏è Back</button>
  <button class="btn btn-primary" id="next2">Next ‚û°Ô∏è</button>
</div>
</div>

<!-- Step 3 -->
<div class="step" id="step3" style="display:none;">
  <div class="row g-3">
    <div class="col-12 col-md-6">
      <label class="form-label">Time to do the work (hr)</label>
      <input id="E7" type="number" class="form-control" value="1">
    </div>
    <div class="col-12 col-md-6">
      <label class="form-label">Time to take and return permit (hr)</label>
      <input id="E8" type="number" class="form-control" value="1">
    </div>
    <div class="col-12 col-md-6">
      <label class="form-label">Total number of days to do the work</label>
      <input id="E15" type="number" class="form-control" value="1">
    </div>
    <div class="col-12 col-md-6">
      <label class="form-label">Time to do the work (hr)</label>
      <input id="E16" type="number" class="form-control" value="0">
    </div>
    <div class="col-12 col-md-6">
      <label class="form-label">Total Number of DTRs on the feeder</label>
      <input id="E17" type="number" class="form-control" value="1">
    </div>
    <div class="col-12 col-md-6">
      <label class="form-label">Total number of DTRs Affected</label>
      <input id="E18" type="number" class="form-control" value="0">
    </div>
  </div>

  <div id="result" class="mt-4"></div> 

  <button class="btn btn-secondary mt-3" id="back3">‚¨ÖÔ∏è Back</button>
  <button class="btn btn-success mt-3" id="finish">‚úÖ Finish</button>
</div>

<script>
  const voltageSelect = document.getElementById("voltage");
  const feederSelect = document.getElementById("feeder");
  const bandSelect = document.getElementById("band");
  const feederInfoDiv = document.getElementById("feederInfo");

  // Feeders grouped by voltage
  const feeders = {
    "11KV": [
      { value: "Unical", text: "Unical" }, 
      { value: "Cameroon", text: "Cameroon" }, 
      { value: "Target", text: "Target" }, 
      { value: "Goldie", text: "Goldie" }, 
      { value: "MCC", text: "MCC" }, 
      { value: "Essien Town", text: "Essien Town" }, 
      { value: "Flourmill", text: "Flourmill" }, 
      { value: "Crutech", text: "Crutech" }, 
      { value: "Anantigha", text: "Anantigha" }, 
      { value: "Esukutan", text: "Esukutan" }, 
      { value: "Federal Housing", text: "Federal Housing" }, 
      { value: "8miles", text: "8miles" }, 
      { value: "Leopard", text: "Leopard" }, 
      { value: "Ikot Enebong", text: "Ikot Enebong" }, 
      { value: "Bacoco", text: "Bacoco" }
    ],
    "33KV": [
      { value: "Transcorp", text: "Transcorp" },
	{ value: "Diamond", text: "Diamond" }, 
      { value: "Amika", text: "Amika" }
    ]
  };

  // Feeder data (transformers + max load)
  const feederData = {
    "Unical": { transformers: 12, maxLoad: 8.5 },   
    "Cameroon": { transformers: 8, maxLoad: 6.2 },
    "Target": { transformers: 10, maxLoad: 7.0 },
    "Goldie": { transformers: 6, maxLoad: 5.1 },
    "Transcorp": { transformers: 26, maxLoad: 1.3 },
    "Amika": { transformers: 11, maxLoad: 14 }, 
	 "Diamond": { transformers: 7, maxLoad: 5.6 } 
  };

  // Populate feeders on voltage selection
  voltageSelect.addEventListener("change", function () {
    feederSelect.innerHTML = '<option value="" disabled selected>Select a Feeder *</option>';
    feederInfoDiv.innerHTML = "";
    const selectedVoltage = this.value;
    if (feeders[selectedVoltage]) {
      feeders[selectedVoltage].forEach(fdr => {
        const option = document.createElement("option");
        option.value = fdr.value;
        option.textContent = fdr.text;
        feederSelect.appendChild(option);
      });
    }
  });

  // Show feeder info when selected + auto populate Peak Load & DTRs
  feederSelect.addEventListener("change", function () {
    const feeder = this.value;
    if (feederData[feeder]) {
      const data = feederData[feeder];
      feederInfoDiv.innerHTML = 
        `üü¢ <b>${feeder}</b> Feeder:<br>
         ‚Ä¢ Number of DTRs: ${data.transformers}<br>
         ‚Ä¢ Maximum Load: ${data.maxLoad} MW`;
      document.getElementById("E5").value = data.maxLoad;  
      document.getElementById("E17").value = data.transformers; 
    } else {
      feederInfoDiv.innerHTML = "";
    }
  });

  // Stepper logic
  function showStep(stepId, stepIndex) {
    if (stepIndex > 1 && (!region.value || !voltage.value || !feeder.value || !band.value)) {
      alert("Please complete Step 1 before proceeding!");
      return;
    }

    document.querySelectorAll(".step").forEach(step => step.style.display = "none");
    document.getElementById(stepId).style.display = "block";
    document.querySelectorAll(".indicator").forEach(ind => ind.classList.remove("active"));
    document.getElementById("ind" + stepIndex).classList.add("active");
  }

  document.getElementById("next1").onclick = () => {
    if (!region.value || !voltage.value || !feeder.value || !band.value) {
      alert("Please complete all required fields!");
      return;
    }
    showStep("step2", 2);
  };
  document.getElementById("back2").onclick = () => showStep("step1", 1);
  document.getElementById("next2").onclick = () => showStep("step3", 3);
  document.getElementById("back3").onclick = () => showStep("step2", 2);

    // Finish & Calculate Section A Total
   // Finish & Calculate Section A Total
  document.getElementById("finish").onclick = () => {
    const region = document.getElementById("region").value;
    const feeder = document.getElementById("feeder").value;
    const voltage = document.getElementById("voltage").value;
    const tariff = parseFloat(bandSelect.value) || 0;
    const tariffText = bandSelect.options[bandSelect.selectedIndex]?.text || "";

    const peakLoad = parseFloat(document.getElementById("E5").value) || 0; 
    const timeWork = parseFloat(document.getElementById("E16").value) || 0;
    const timePermit = parseFloat(document.getElementById("E8").value) || 0;
    const totalDays = parseFloat(document.getElementById("E15").value) || 0;
    const totalDTRs = parseFloat(document.getElementById("E17").value) || 1;
    const affectedDTRs = parseFloat(document.getElementById("E18").value) || 0;

    const part1 = (peakLoad * 1000) * timePermit * tariff * 1.075;
    const part2 = (affectedDTRs / totalDTRs) * (peakLoad * 1000) * timeWork * totalDays * tariff * 1.075;
    const fixedCost = 40000;
    const sectionATotal = part1 + part2 + fixedCost;

    document.getElementById("result").innerHTML = `
      <div id="resultCard" class="card shadow-sm" style="background:lightgray">
        <div class="card-body">
          <h3 class="card-title mb-3">üìã LOR Summary</h3>
          <div class="table-responsive">
            <table class="table table-bordered table-striped align-middle">
              <tbody>
                <tr><th>Region</th><td>${region}</td></tr>
                <tr><th>Feeder</th><td>${feeder}</td></tr>
                <tr><th>Voltage Level</th><td>${voltage}</td></tr>
                <tr><th>Tariff</th><td>${tariffText} (‚Ç¶${tariff})</td></tr>
                <tr><th>Time to do the work (hr)</th><td>${timeWork}</td></tr>
                <tr><th>Total number of days</th><td>${totalDays}</td></tr>
                <tr><th>Total Number of DTRs</th><td>${totalDTRs}</td></tr>
                <tr><th>DTRs Affected</th><td>${affectedDTRs}</td></tr>
                <tr><th>Time for permit (hr)</th><td>${timePermit}</td></tr>
              </tbody>
            </table>
          </div>

          <h3 class="mt-4">üí∞ LOR Breakdown</h3>
          <ul class="list-group mb-3">
            <li class="list-group-item d-flex justify-content-between">
              <span>Part 1</span>
              <span>‚Ç¶${part1.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Part 2</span>
              <span>‚Ç¶${part2.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Part 3 (Fixed Cost)</span>
              <span>‚Ç¶${fixedCost.toLocaleString()}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between fw-bold list-group-item-success">
              <span>Total</span>
              <span>‚Ç¶${sectionATotal.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
            </li>
          </ul>

          <button id="exportPDF" class="btn btn-danger no-export">
  üìÑ Export to PDF
</button>
        </div>
      </div>
    `;

    // Attach export function after rendering
   document.getElementById("exportPDF").addEventListener("click", () => {
  const element = document.getElementById("resultCard");
  const opt = {
    margin:       10,
    filename:     `LOR_Calculation_${region}_${feeder}.pdf`,
    image:        { type: 'jpeg', quality: 0.98 },
    html2canvas:  { scale: 2, ignoreElements: (el) => el.classList.contains("no-export") },
    jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };
  html2pdf().set(opt).from(element).save();
});
  };
</script>
	
	<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
</body>
</html>


